// Import Java classes
var StringReader = Packages.java.io.StringReader;
var ByteArrayOutputStream = Packages.java.io.ByteArrayOutputStream;
var Document = Packages.com.lowagie.text.Document;
var RtfWriter2 = Packages.com.lowagie.text.rtf.RtfWriter2;
var HTMLWorker = Packages.com.lowagie.text.html.simpleparser.HTMLWorker;

// HTML de entrada
var htmlContent = msg['HTML_CONTENT'].toString(); // Aquí debes ajustar el nodo según tu mensaje

// Preparar salida
var outputStream = new ByteArrayOutputStream();
var document = new Document();

try {
    // Crear documento RTF
    RtfWriter2.getInstance(document, outputStream);
    document.open();

    // Convertir HTML a RTF
    var reader = new StringReader(htmlContent);
    HTMLWorker.parseToList(reader, null).forEach(function(element) {
        document.add(element);
    });

    document.close();

    // Convertir a texto RTF final
    var rtfContent = outputStream.toString();
    
    // Guardar o asignar el resultado
    msg['RTF_CONTENT'] = rtfContent; // Puedes enviarlo a algún campo OBX u otro destino
    
} catch (e) {
    logger.error("Error al convertir HTML a RTF: " + e);
}
