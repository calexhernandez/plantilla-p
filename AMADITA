script.engine.imports = com.mirth.connect.server.controllers.ChannelUtil


var channelId = 'xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx';
ChannelUtil.stop(channelId);
java.lang.Thread.sleep(5000);
ChannelUtil.start(channelId);


# Variables
$MirthURL = "http://localhost:8080/api"
$username = "admin"
$password = "admin"
$channelId = "12345678-1234-1234-1234-123456789abc"

# Autenticaci√≥n - Obtener Token
$loginBody = @{ username = $username; password = $password } | ConvertTo-Json
$response = Invoke-RestMethod -Uri "$MirthURL/users/_login" -Method Post -Body $loginBody -ContentType "application/json"

# Extraer Token
$token = $response.message

# Iniciar canal
Invoke-RestMethod -Uri "$MirthURL/channels/$channelId/_start" -Method Post -Headers @{ "Authorization" = "Mirth $token" }

Write-Output "Canal iniciado a $(Get-Date)"
