var IO = Packages.io.socket.client.IO;
var Socket = Packages.io.socket.client.Socket;
var JSONObject = Packages.org.json.JSONObject;
var EmitterListener = Packages.io.socket.emitter.Emitter.Listener;

logger.info("Connecting to Socket.IO...");

var options = IO.Options();
options.forceNew = true;
options.reconnection = false;
options.reconnectionAttempts = 5;
options.timeout = 5000;
options.autoConnect = true;

var transports = java.lang.reflect.Array.newInstance(java.lang.String, 1);
transports[0] = "websocket";
options.transports = transports;

// Set auth
var authObj = new JSONObject();
authObj.put("username", "employees.consultor");
authObj.put("password", "gVh6#1TSyPt2");
options.auth = authObj;

var socket = IO.socket("http://socket-handle-tests.amaditaplayground.com:30008", options);

// CONNECT
socket.on("connect", new EmitterListener({
    call: function(args) {
        logger.info("‚úÖ Connected to Socket.IO");

        var auth = new JSONObject();
        auth.put("username", "employees.consultor");
        auth.put("password", "gVh6#1TSyPt2");
        socket.emit("auth", auth);
    }
}));

// SENT ORDER RESPONSE
socket.on("sent order", new EmitterListener({
    call: function(args) {
        var response = args[0];
        logger.info("üì• Response from 'sent order': " + response.toString());
        socket.disconnect();
    }
}));

// CONNECT ERROR
socket.on("connect_error", new EmitterListener({
    call: function(args) {
        var err = args[0];
        logger.error("‚ùå Connect error: " + err.toString());
    }
}));

socket.connect();
